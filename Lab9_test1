# coding=utf-8
 
import RPi.GPIO as GPIO
import datetime
import csv
from datetime import datetime
import argparse
import sys
from datetime import date
import time
import board


def my_callback(channel):
    counts = 0
    second_count = 0
    num_minutes = 0
    metadata = ['Timestamp', 'Minutes', 'Counts']
    writer.writerow(metadata)
    start_time = time.time()
    itime = start_time
    print('function')
    while itime < (start_time + run_time):
        if GPIO.input(channel) == GPIO.HIGH:
            if second_count % 60 == 0:
                data = [time.time(), num_minutes, count]
                count = 0
                num_minutes += 1
                print('in the if')
            else:
                data = [time.time()]
                count += 1
                print('in the else')
            writer.writerow(data)
        itime = time.time()
        second_count += 1

run_time = int(sys.argv[1])
datafile = sys.argv[2]
file = open(datafile, "w")
writer = csv.writer(file)


try:
    GPIO.setmode(GPIO.BCM)
    GPIO.setup(6, GPIO.IN)
    GPIO.add_event_detect(6, GPIO.BOTH, callback=my_callback)

my_callback(6)

finally:
    GPIO.cleanup()
 
print("Goodbye!")